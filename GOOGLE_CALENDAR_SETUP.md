# 📅 구글 캘린더 연동 설정 가이드

냉요(냉장고 요정) 앱에서 구글 캘린더 동기화 기능을 사용하려면 구글 클라우드 콘솔에서 API 인증 정보를 설정해야 합니다.

## 🚀 설정 단계

### 1단계: 구글 클라우드 프로젝트 생성

1. https://console.cloud.google.com/ 접속
2. 구글 계정으로 로그인
3. 상단의 프로젝트 선택 드롭다운 클릭
4. "새 프로젝트" 클릭
5. 프로젝트 이름 입력 (예: "냉요-캘린더") → "만들기" 클릭

### 2단계: Google Calendar API 활성화

1. 좌측 메뉴 → "API 및 서비스" → "라이브러리"
2. 검색창에 "Google Calendar API" 검색
3. "Google Calendar API" 클릭
4. "사용 설정" 버튼 클릭

### 3단계: OAuth 동의 화면 구성

1. 좌측 메뉴 → "API 및 서비스" → "OAuth 동의 화면"
2. User Type: **"외부"** 선택 → "만들기" 클릭
3. 앱 정보 입력:
   - 앱 이름: `냉요 (냉장고 요정)`
   - 사용자 지원 이메일: 본인 이메일
   - 개발자 연락처 정보: 본인 이메일
4. "저장 후 계속" 클릭
5. 범위(Scopes) 단계:
   - "범위 추가 또는 삭제" 클릭
   - `https://www.googleapis.com/auth/calendar` 선택
   - "업데이트" → "저장 후 계속"
6. 테스트 사용자 추가:
   - "+ ADD USERS" 클릭
   - 본인 구글 계정 이메일 입력
   - "저장 후 계속"
7. 요약 페이지에서 "대시보드로 돌아가기"

### 4단계: OAuth 클라이언트 ID 만들기

1. 좌측 메뉴 → "API 및 서비스" → "사용자 인증 정보"
2. 상단의 "+ 사용자 인증 정보 만들기" → "OAuth 클라이언트 ID" 클릭
3. 애플리케이션 유형: **"데스크톱 앱"** 선택
4. 이름: `냉요 데스크톱 클라이언트`
5. "만들기" 클릭

### 5단계: credentials.json 다운로드

1. 생성된 OAuth 클라이언트 옆의 다운로드 버튼(⬇️) 클릭
2. JSON 파일 다운로드
3. 다운로드한 파일 이름을 **`credentials.json`**으로 변경
4. 파일을 `freeze_agent` 프로젝트 폴더 (app.py가 있는 위치)에 복사

**중요**: `.gitignore` 파일에 `credentials.json`과 `token.pickle`이 포함되어 있는지 확인하세요!

```bash
# .gitignore에 추가
credentials.json
token.pickle
```

---

## 🎯 사용 방법

### 1. 로컬에서 사용하는 경우

1. 위 단계를 완료하여 `credentials.json` 파일을 프로젝트 폴더에 저장
2. 앱 실행: `streamlit run app.py`
3. 대시보드에서 "📅 구글 캘린더 동기화" 버튼 클릭
4. 첫 실행 시 브라우저가 열리며 구글 로그인 요청
5. 로그인 후 권한 허용
6. 이후부터는 자동으로 동기화됨

### 2. Streamlit Cloud에 배포하는 경우

**주의**: Streamlit Cloud에서는 파일 시스템에 저장할 수 없으므로, 구글 캘린더 연동은 **로컬 환경에서만** 작동합니다.

대안:
1. **서비스 계정 사용** (고급)
2. **로컬 앱으로만 사용**
3. **다른 클라우드 배포 (예: Heroku, Railway)**

---

## 🔒 보안 주의사항

1. **절대로 GitHub에 업로드하지 마세요!**
   - `credentials.json` (OAuth 클라이언트 비밀)
   - `token.pickle` (사용자 액세스 토큰)

2. `.gitignore`에 다음 항목이 있는지 확인:
```
credentials.json
token.pickle
*.pickle
```

3. 공개 저장소에 배포하지 마세요

---

## 🛠️ 문제 해결

### "credentials.json이 없습니다" 오류
→ 4-5단계를 다시 확인하고 파일을 올바른 위치에 저장하세요

### "OAuth 동의 화면에서 승인되지 않은 사용자" 오류
→ OAuth 동의 화면에서 본인의 이메일을 테스트 사용자로 추가하세요

### 토큰 만료 오류
→ `token.pickle` 파일을 삭제하고 다시 로그인하세요

### Streamlit Cloud에서 작동하지 않음
→ Streamlit Cloud는 파일 시스템 저장을 지원하지 않아 현재 버전에서는 로컬에서만 작동합니다

---

## 📝 동작 원리

1. **첫 실행**: `credentials.json`을 사용해 OAuth 인증 → `token.pickle` 생성
2. **이후 실행**: 저장된 `token.pickle`을 사용해 자동 인증
3. **캘린더 이벤트 생성**: 각 음식의 소비기한 날짜에 이벤트 추가
4. **알림 설정**: 소비기한 1일 전, 3일 전 알림 자동 설정

---

## ✅ 완료 체크리스트

- [ ] 구글 클라우드 프로젝트 생성
- [ ] Google Calendar API 활성화
- [ ] OAuth 동의 화면 구성 (테스트 사용자 추가)
- [ ] OAuth 클라이언트 ID 생성 (데스크톱 앱)
- [ ] credentials.json 다운로드 및 프로젝트 폴더에 저장
- [ ] .gitignore에 credentials.json, token.pickle 추가
- [ ] 앱 실행 후 "구글 캘린더 동기화" 버튼 테스트

---

문의사항이 있으면 이슈로 등록해주세요! 🙌
